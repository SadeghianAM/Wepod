<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±ÛŒÙ†Øª Ø­Ø³Ø§Ø¨ - ÙˆÛŒ Ù‡Ø§Ø¨</title>
    <style>
      :root {
        --primary-color: #00ae70;
        --primary-dark: #089863;
        --primary-light: #e6f7f2;
        --bg-color: #f8fcf9;
        --text-color: #222;
        --secondary-text-color: #555;
        --card-bg: #ffffff;
        --header-text: #ffffff;
        --shadow-color-light: rgba(0, 174, 112, 0.07);
        --shadow-color-medium: rgba(0, 174, 112, 0.12);
        --danger-color: #d93025;
        --danger-bg: #fce8e6;
        --info-color: #1a73e8;
        --info-bg: #e8f0fe;
        --border-radius: 0.75rem;
        --border-color: #e9e9e9;
      }
      @font-face {
        font-family: "Vazirmatn";
        src: url("/assets/fonts/Vazirmatn[wght].ttf") format("truetype");
        font-weight: 100 900;
        font-display: swap;
      }
      *,
      *::before,
      *::after {
        font-family: "Vazirmatn", sans-serif !important;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        direction: rtl;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header,
      footer {
        background: var(--primary-color);
        color: var(--header-text);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px var(--shadow-color-light);
        position: relative;
        z-index: 10;
        flex-shrink: 0;
      }
      header {
        height: 70px;
      }
      header h1 {
        font-size: 1.2rem;
        font-weight: 700;
      }
      footer {
        height: 60px;
        font-size: 0.85rem;
        margin-top: auto;
      }
      main {
        flex-grow: 1;
        padding: 2rem;
        max-width: 900px;
        width: 100%;
        margin: 0 auto;
      }
      .tool-card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px var(--shadow-color-light);
        overflow: hidden;
      }
      .tool-card h2 {
        font-size: 1.2rem;
        font-weight: 700;
        padding: 1rem 1.5rem;
        background-color: var(--bg-color);
        color: var(--primary-dark);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .tool-card .card-content {
        padding: 1.5rem;
      }
      .form-section {
        margin-bottom: 2rem;
        border-bottom: 1px dashed var(--border-color);
        padding-bottom: 2rem;
      }
      .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }
      label {
        margin-bottom: 0.6rem;
        font-weight: 600;
        font-size: 1rem;
        color: var(--secondary-text-color);
      }
      input,
      textarea {
        width: 100%;
        font-size: 1rem;
        padding: 0.7em 1em;
        border-radius: 0.6em;
        border: 1.5px solid #ddd;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      input:focus,
      textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 174, 112, 0.15);
      }
      input.input-error {
        border-color: var(--danger-color);
      }
      textarea {
        height: 100px;
        resize: vertical;
      }
      input[inputmode="numeric"] {
        direction: ltr;
        text-align: center;
        letter-spacing: 2px;
      }
      .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.8rem 1rem;
        border: none;
        border-radius: 0.6rem;
        font-size: 1rem;
        font-weight: 600;
        color: var(--header-text);
        cursor: pointer;
        transition: 0.2s;
      }
      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: var(--primary-color);
      }
      .btn-danger {
        background-color: var(--danger-color);
      }
      .btn-info {
        background-color: var(--info-color);
      }
      .btn-primary:hover:not(:disabled) {
        background-color: var(--primary-dark);
      }
      .btn-danger:hover:not(:disabled) {
        background-color: #c02717;
      }
      .btn-info:hover:not(:disabled) {
        background-color: #1558c0;
      }
      .btn:disabled {
        background-color: #ccc;
        color: #888;
        cursor: not-allowed;
      }
      #autoFillBtn {
        margin-top: 0.75rem;
        width: 100%;
      }

      .input-message,
      .result {
        border-radius: var(--border-radius);
        padding: 0.6rem 1rem;
        border: 1px solid transparent;
        border-inline-start-width: 4px;
        margin-top: 0.75rem;
        font-size: 0.9rem;
        font-weight: 500;
        display: none;
      }
      .result {
        text-align: center;
      }
      .input-message.success,
      .input-message.error,
      .result.success,
      .result.error {
        display: block;
      }
      .input-message.success,
      .result.success {
        background-color: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-dark);
      }
      .input-message.error,
      .result.error {
        background-color: var(--danger-bg);
        border-color: var(--danger-color);
        color: var(--danger-color);
      }

      a {
        text-decoration: none;
      }
      .back-link {
        display: block;
        margin-top: 2rem;
        color: var(--primary-dark);
        text-align: center;
      }
      .back-link:hover {
        color: var(--primary-color);
        text-decoration: underline;
      }

      .jdp-popover {
        position: absolute;
        background: #fff;
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        box-shadow: 0 8px 24px var(--shadow-color-medium);
        padding: 0.75rem;
        width: 280px;
        z-index: 9999;
      }
      .jdp-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
        font-weight: 700;
        color: var(--primary-dark);
      }
      .jdp-nav-btn {
        background: var(--primary-color);
        color: #fff;
        border: none;
        padding: 0.25rem 0.6rem;
        border-radius: 0.4rem;
        cursor: pointer;
      }
      .jdp-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
      }
      .jdp-weekday {
        text-align: center;
        font-size: 0.85rem;
        color: var(--secondary-text-color);
        padding: 0.3rem 0;
      }
      .jdp-day {
        text-align: center;
        padding: 0.4rem 0;
        border-radius: 0.4rem;
        cursor: pointer;
        background: #fafafa;
        border: 1px solid #f0f0f0;
      }
      .jdp-day:hover {
        background: var(--primary-light);
      }
      .jdp-day.other {
        color: #bbb;
        background: #f8f9fa;
      }
      .jdp-hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .form-row,
        .button-group {
          grid-template-columns: 1fr;
          gap: 0;
        }
        .form-group {
          margin-bottom: 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="header-placeholder"></div>
    <main>
      <div class="tool-card">
        <h2>ğŸ“„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±ÛŒÙ†Øª Ø­Ø³Ø§Ø¨</h2>
        <div class="card-content">
          <div class="form-section">
            <div class="form-group">
              <label for="autoFillInput">âœ¨ ØªÚ©Ù…ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø±ÙˆÛŒ Ù…ØªÙ† ØªÛŒÚ©Øª</label>
              <textarea
                id="autoFillInput"
                placeholder="Ù…ØªÙ† ØªÛŒÚ©Øª Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
              ></textarea>
            </div>
            <button
              class="btn btn-info"
              id="autoFillBtn"
              type="button"
              onclick="autoFillForm()"
            >
              Ù¾Ø± Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ±Ù…
            </button>
          </div>

          <div class="form-section">
            <div class="form-row">
              <div class="form-group">
                <label for="nameInput">ğŸ‘¤ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                <input
                  type="text"
                  id="nameInput"
                  placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±"
                />
              </div>
              <div class="form-group">
                <label for="nationalIdInput">ğŸ’³ Ú©Ø¯Ù…Ù„ÛŒ</label>
                <input
                  type="text"
                  id="nationalIdInput"
                  placeholder="--- ------ -"
                  inputmode="numeric"
                  maxlength="12"
                />
                <div id="nationalIdMessage" class="input-message"></div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="mobileInput">ğŸ“± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
                <input
                  type="text"
                  id="mobileInput"
                  placeholder="09-- --- ----"
                  inputmode="numeric"
                  maxlength="13"
                />
                <div id="mobileMessage" class="input-message"></div>
              </div>
            </div>
            <hr
              style="
                border: none;
                border-top: 1px dashed var(--border-color);
                margin: 1.5rem 0;
              "
            />
            <div class="form-row">
              <div class="form-group">
                <label for="fromDateInput">ğŸ“… Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
                <input
                  type="text"
                  id="fromDateInput"
                  placeholder="Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯"
                  readonly
                />
                <div id="fromDateMessage" class="input-message"></div>
              </div>
              <div class="form-group">
                <label for="toDateInput">ğŸ“… ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
                <input
                  type="text"
                  id="toDateInput"
                  placeholder="Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯"
                  readonly
                />
              </div>
            </div>
          </div>

          <div class="button-group">
            <button class="btn btn-danger" type="button" onclick="clearForm()">
              ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
            </button>
            <button
              class="btn btn-primary"
              id="copyBtn"
              onclick="copyRequest()"
              disabled
            >
              ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª
            </button>
          </div>
          <div id="copyResult" class="result"></div>
          <a href="/index.html" class="back-link">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
        </div>
      </div>
    </main>
    <div id="footer-placeholder"></div>

    <script src="/js/header.js"></script>
    <script>
      const requiredFields = [
        "nameInput",
        "nationalIdInput",
        "mobileInput",
        "fromDateInput",
        "toDateInput",
      ];

      // --- Jalali Date Picker Logic ---
      function jalaliToGregorian(jy, jm, jd) {
        jy += 1595;
        let days =
          -355668 +
          365 * jy +
          ~~(jy / 33) * 8 +
          ~~(((jy % 33) + 3) / 4) +
          jd +
          (jm < 7 ? (jm - 1) * 31 : (jm - 7) * 30 + 186);
        let gy = 400 * ~~(days / 146097);
        days %= 146097;
        if (days > 36524) {
          gy += 100 * ~~(--days / 36524);
          days %= 36524;
          if (days >= 365) days++;
        }
        gy += 4 * ~~(days / 1461);
        days %= 1461;
        if (days > 365) {
          gy += ~~((days - 1) / 365);
          days = (days - 1) % 365;
        }
        let gd = days + 1;
        const sal_a = [
          0,
          31,
          (gy % 4 === 0 && gy % 100 !== 0) || gy % 400 === 0 ? 29 : 28,
          31,
          30,
          31,
          30,
          31,
          31,
          30,
          31,
          30,
          31,
        ];
        let gm = 0;
        for (; gm < 13 && gd > sal_a[gm]; gm++) gd -= sal_a[gm];
        return new Date(gy, gm - 1, gd);
      }
      function toPersian(date) {
        const parts = date.toLocaleDateString("fa-IR-u-nu-latn").split("/");
        return parts.map((part) => parseInt(part, 10));
      }
      function pad2(n) {
        return String(n).padStart(2, "0");
      }
      function formatJalaliDisplay(jy, jm, jd) {
        return `${jy}/${pad2(jm)}/${pad2(jd)}`;
      }
      function isJalaliLeap(jy) {
        return (
          ((((((jy - 474) % 2820) + 2820) % 2820) + 474 + 38) * 682) % 2816 <
          682
        );
      }
      function jalaliMonthLength(jy, jm) {
        if (jm <= 6) return 31;
        if (jm <= 11) return 30;
        return isJalaliLeap(jy) ? 30 : 29;
      }
      class JalaliDatePicker {
        constructor(inputId) {
          this.input = document.getElementById(inputId);
          if (!this.input) return;
          const [jy, jm] = toPersian(new Date());
          this.jy = jy;
          this.jm = jm;
          this.pop = document.createElement("div");
          this.pop.className = "jdp-popover jdp-hidden";
          document.body.appendChild(this.pop);
          this.boundClickOutside = (e) => {
            if (!this.pop.contains(e.target) && e.target !== this.input)
              this.hide();
          };
          this.input.addEventListener("focus", () => this.show());
          this.input.addEventListener("click", () => this.show());
          window.addEventListener("resize", () => this.position());
        }
        show() {
          this.render();
          this.position();
          this.pop.classList.remove("jdp-hidden");
          setTimeout(
            () =>
              document.addEventListener("mousedown", this.boundClickOutside),
            0
          );
        }
        hide() {
          this.pop.classList.add("jdp-hidden");
          document.removeEventListener("mousedown", this.boundClickOutside);
        }
        position() {
          const rect = this.input.getBoundingClientRect();
          this.pop.style.top = window.scrollY + rect.bottom + 6 + "px";
          this.pop.style.left = window.scrollX + rect.left + "px";
        }
        nav(delta) {
          this.jm += delta;
          if (this.jm < 1) {
            this.jm = 12;
            this.jy--;
          }
          if (this.jm > 12) {
            this.jm = 1;
            this.jy++;
          }
          this.render();
        }
        render() {
          const weekDays = ["Ø´", "ÛŒ", "Ø¯", "Ø³", "Ú†", "Ù¾", "Ø¬"];
          const firstG = jalaliToGregorian(this.jy, this.jm, 1);
          const firstWeekday = (firstG.getDay() + 1) % 7;
          const daysInMonth = jalaliMonthLength(this.jy, this.jm);
          let html = `<div class="jdp-header"><button class="jdp-nav-btn" data-nav="-1">&rarr;</button><div>${new Intl.DateTimeFormat(
            "fa-IR",
            { month: "long" }
          ).format(firstG)} ${new Intl.DateTimeFormat("fa-IR", {
            year: "numeric",
          }).format(
            firstG
          )}</div><button class="jdp-nav-btn" data-nav="1">&larr;</button></div><div class="jdp-grid">${weekDays
            .map((w) => `<div class="jdp-weekday">${w}</div>`)
            .join("")}`;
          for (let i = 0; i < firstWeekday; i++)
            html += `<div class="jdp-day other"></div>`;
          for (let d = 1; d <= daysInMonth; d++)
            html += `<div class="jdp-day" data-day="${d}">${new Intl.NumberFormat(
              "fa-IR"
            ).format(d)}</div>`;
          this.pop.innerHTML = html + `</div>`;
          this.pop
            .querySelectorAll("[data-nav]")
            .forEach((btn) =>
              btn.addEventListener("click", (e) =>
                this.nav(parseInt(e.currentTarget.dataset.nav, 10))
              )
            );
          this.pop.querySelectorAll("[data-day]").forEach((cell) => {
            cell.addEventListener("click", (e) => {
              const d = parseInt(e.currentTarget.dataset.day, 10);
              this.input.value = formatJalaliDisplay(this.jy, this.jm, d);
              this.hide();
              if (typeof updateCopyButton === "function") updateCopyButton();
            });
          });
        }
      }

      // --- Formatting Functions ---
      function formatMobileNumber(input) {
        let value = input.value.replace(/\D/g, "").slice(0, 11);
        if (value.length > 7)
          input.value = value
            .replace(/(\d{4})(\d{3})(\d{1,4})/, "$1 $2 $3")
            .trim();
        else if (value.length > 4)
          input.value = value.replace(/(\d{4})(\d{1,3})/, "$1 $2").trim();
        else input.value = value;
        return value;
      }

      function formatNationalId(input) {
        let value = input.value.replace(/\D/g, "").slice(0, 10);
        if (value.length >= 10)
          input.value = value.replace(/(\d{3})(\d{6})(\d{1})/, "$1 $2 $3");
        else if (value.length > 3)
          input.value = value.replace(/(\d{3})(\d{0,6})/, "$1 $2");
        else input.value = value;
        return value;
      }

      // --- Validation Functions ---
      function isValidIranianNationalCode(input) {
        if (!/^\d{10}$/.test(input) || /^(\d)\1{9}$/.test(input)) return false;
        let check = +input[9];
        let sum =
          Array(9)
            .fill()
            .map((_, i) => +input[i] * (10 - i))
            .reduce((x, y) => x + y) % 11;
        return sum < 2 ? check === sum : check === 11 - sum;
      }

      function validatePhone(inputEl, msgEl, rawValue) {
        msgEl.className = "input-message";
        if (!rawValue) return true;
        if (!/^09\d{9}$/.test(rawValue)) {
          msgEl.textContent = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Û±Û± Ø±Ù‚Ù… Ùˆ Ø¨Ø§ Û°Û¹ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯.";
          msgEl.classList.add("error");
          return false;
        }
        return true;
      }

      function validateNationalId(inputEl, msgEl, rawValue) {
        msgEl.className = "input-message";
        if (!rawValue) return true;
        if (rawValue.length > 0 && rawValue.length < 10) {
          msgEl.textContent = "Ú©Ø¯Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ Û±Û° Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯.";
          msgEl.classList.add("error");
          return false;
        }
        if (rawValue.length === 10 && !isValidIranianNationalCode(rawValue)) {
          msgEl.textContent = "Ú©Ø¯Ù…Ù„ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.";
          msgEl.classList.add("error");
          return false;
        }
        if (rawValue.length === 10 && isValidIranianNationalCode(rawValue)) {
          msgEl.textContent = "Ú©Ø¯Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.";
          msgEl.classList.add("success");
        }
        return true;
      }

      // --- Main Form Logic ---
      function updateCopyButton() {
        let allValid = true;
        let emptyFields = false;
        requiredFields.forEach((id) => {
          const field = document.getElementById(id);
          if (!field.value.trim()) {
            allValid = false;
            emptyFields = true;
          }
          field.classList.remove("input-error");
        });

        const mobileInput = document.getElementById("mobileInput");
        const nationalIdInput = document.getElementById("nationalIdInput");
        const isMobileValid = validatePhone(
          mobileInput,
          document.getElementById("mobileMessage"),
          mobileInput.value.replace(/\D/g, "")
        );
        const isNationalIdValid = validateNationalId(
          nationalIdInput,
          document.getElementById("nationalIdMessage"),
          nationalIdInput.value.replace(/\D/g, "")
        );

        if (!isMobileValid || !isNationalIdValid) {
          allValid = false;
        }

        if (!emptyFields && !isMobileValid)
          mobileInput.classList.add("input-error");
        if (!emptyFields && !isNationalIdValid)
          nationalIdInput.classList.add("input-error");

        const fromDateInput = document.getElementById("fromDateInput");
        const toDateInput = document.getElementById("toDateInput");
        const fromDateVal = fromDateInput.value.replace(/\//g, "");
        const toDateVal = toDateInput.value.replace(/\//g, "");
        const fromDateMsg = document.getElementById("fromDateMessage");

        fromDateMsg.className = "input-message";

        if (
          fromDateVal &&
          toDateVal &&
          parseInt(fromDateVal) > parseInt(toDateVal)
        ) {
          allValid = false;
          const errorMsg = "ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø´Ø¯.";
          fromDateMsg.textContent = errorMsg;
          fromDateMsg.className = "input-message error";
          fromDateInput.classList.add("input-error");
        }

        document.getElementById("copyBtn").disabled = !allValid;
      }

      function clearForm() {
        requiredFields.forEach((id) => {
          document.getElementById(id).value = "";
          document.getElementById(id).classList.remove("input-error");
        });
        document.getElementById("autoFillInput").value = "";
        document.getElementById("nationalIdMessage").className =
          "input-message";
        document.getElementById("mobileMessage").className = "input-message";
        document.getElementById("fromDateMessage").className = "input-message";
        document.getElementById("copyResult").className = "result";
        updateCopyButton();
      }

      function copyRequest() {
        if (document.getElementById("copyBtn").disabled) return;

        const name = document.getElementById("nameInput").value.trim();
        const mobile = document
          .getElementById("mobileInput")
          .value.replace(/\D/g, "");
        const nationalId = document
          .getElementById("nationalIdInput")
          .value.replace(/\D/g, "");
        const fromDate = document.getElementById("fromDateInput").value.trim();
        const toDate = document.getElementById("toDateInput").value.trim();

        const reportText = `Ø¨Ø§Ø³Ù„Ø§Ù…
Ú©Ø§Ø±Ø¨Ø± ${name} Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ${mobile} Ùˆ Ú©Ø¯Ù…Ù„ÛŒ ${nationalId} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±ÛŒÙ†Øª Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø² ØªØ§Ø±ÛŒØ® ${fromDate} ØªØ§ ØªØ§Ø±ÛŒØ® ${toDate} Ø¯Ø§Ø±Ø¯
Ø¨Ø§ØªØ´Ú©Ø±`;

        navigator.clipboard.writeText(reportText).then(
          () => {
            const res = document.getElementById("copyResult");
            res.textContent = "âœ… Ù…ØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯!";
            res.className = "result success";
          },
          () => {
            const res = document.getElementById("copyResult");
            res.textContent = "âŒ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ø±Ø® Ø¯Ø§Ø¯.";
            res.className = "result error";
          }
        );
      }

      // --- Date Parsing and Autofill Logic ---
      function findDatesInText(text) {
        const [currentYear] = toPersian(new Date());
        const allMatches = [];
        const monthMap = {
          ÙØ±ÙˆØ±Ø¯ÛŒÙ†: 1,
          Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª: 2,
          Ø®Ø±Ø¯Ø§Ø¯: 3,
          ØªÛŒØ±: 4,
          Ù…Ø±Ø¯Ø§Ø¯: 5,
          Ø´Ù‡Ø±ÛŒÙˆØ±: 6,
          Ù…Ù‡Ø±: 7,
          Ø¢Ø¨Ø§Ù†: 8,
          Ø¢Ø°Ø±: 9,
          Ø¯ÛŒ: 10,
          Ø¨Ù‡Ù…Ù†: 11,
          Ø§Ø³ÙÙ†Ø¯: 12,
        };

        const patterns = [
          // Pattern 1: YYYY/MM/DD
          {
            regex: /(?<![\d\/])(1[34]\d{2})\/(\d{1,2})\/(\d{1,2})(?![\d\/])/g,
            map: (m) => ({ year: m[1], month: m[2], day: m[3] }),
          },
          // Pattern 2: DD MonthName YYYY (MODIFIED)
          {
            regex: new RegExp(
              `(?<!\\d)(\\d{1,2})\\s+(${Object.keys(monthMap).join(
                "|"
              )})(\\s+1[34]\\d{2})?(?!\\d)`,
              "g"
            ),
            map: (m) => ({
              year: m[3] ? m[3].trim() : currentYear,
              month: monthMap[m[2]],
              day: m[1],
            }),
          },
          // Pattern 3: MM/DD
          {
            regex: /(?<![\d\/])(\d{1,2})\/(\d{1,2})(?![\d\/])/g,
            map: (m) => ({ year: currentYear, month: m[1], day: m[2] }),
          },
        ];

        let processedText = text;
        let foundFullDates = [];

        // First pass for full dates to avoid re-matching
        for (const match of processedText.matchAll(patterns[0].regex)) {
          const date = patterns[0].map(match);
          allMatches.push({ ...date, index: match.index });
          foundFullDates.push({ index: match.index, length: match[0].length });
        }

        // Process other patterns, avoiding areas where full dates were found
        for (let i = 1; i < patterns.length; i++) {
          for (const match of processedText.matchAll(patterns[i].regex)) {
            // Check if this match is inside an already found full date
            const isInsideFullDate = foundFullDates.some(
              (fd) =>
                match.index >= fd.index && match.index < fd.index + fd.length
            );
            if (!isInsideFullDate) {
              const date = patterns[i].map(match);
              allMatches.push({ ...date, index: match.index });
            }
          }
        }

        return allMatches.sort((a, b) => a.index - b.index);
      }

      function autoFillForm() {
        const rawText = document.getElementById("autoFillInput").value.trim();
        if (!rawText) return;

        // --- MODIFICATION: Clear only necessary fields, not the autoFillInput ---
        requiredFields.forEach((id) => {
          const field = document.getElementById(id);
          if (field) field.value = "";
        });
        document.getElementById("nationalIdMessage").className =
          "input-message";
        document.getElementById("mobileMessage").className = "input-message";
        document.getElementById("fromDateMessage").className = "input-message";

        const textWithEnglishNumerals = rawText.replace(/[Û°-Û¹]/g, (d) =>
          "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d)
        );

        // Fill Mobile and National ID
        const mobileMatch = textWithEnglishNumerals.match(/09\d{9}/);
        if (mobileMatch)
          handleMobileInput({ target: { value: mobileMatch[0] } });

        const nationalIdMatch = textWithEnglishNumerals.match(/\b\d{10}\b/);
        if (nationalIdMatch)
          handleNationalIdInput({ target: { value: nationalIdMatch[0] } });

        // Fill Dates using the robust function
        const foundDates = findDatesInText(textWithEnglishNumerals);
        if (foundDates.length > 0) {
          const startDate = foundDates[0];
          document.getElementById("fromDateInput").value = formatJalaliDisplay(
            parseInt(startDate.year),
            parseInt(startDate.month),
            parseInt(startDate.day)
          );
        }
        if (foundDates.length > 1) {
          const endDate = foundDates[1];
          document.getElementById("toDateInput").value = formatJalaliDisplay(
            parseInt(endDate.year),
            parseInt(endDate.month),
            parseInt(endDate.day)
          );
        }

        updateCopyButton();
      }

      // --- Event Handlers ---
      function handleMobileInput(e) {
        const mobileInput = document.getElementById("mobileInput");
        mobileInput.value = e.target.value;
        const pureValue = formatMobileNumber(mobileInput);
        validatePhone(
          mobileInput,
          document.getElementById("mobileMessage"),
          pureValue
        );
        updateCopyButton();
      }
      function handleNationalIdInput(e) {
        const nationalIdInput = document.getElementById("nationalIdInput");
        nationalIdInput.value = e.target.value;
        const pureValue = formatNationalId(nationalIdInput);
        validateNationalId(
          nationalIdInput,
          document.getElementById("nationalIdMessage"),
          pureValue
        );
        updateCopyButton();
      }

      // --- Attach Event Listeners ---
      document.addEventListener("DOMContentLoaded", () => {
        new JalaliDatePicker("fromDateInput");
        new JalaliDatePicker("toDateInput");

        document
          .getElementById("mobileInput")
          .addEventListener("input", handleMobileInput);
        document
          .getElementById("nationalIdInput")
          .addEventListener("input", handleNationalIdInput);

        requiredFields.forEach((id) => {
          if (id !== "mobileInput" && id !== "nationalIdInput") {
            document
              .getElementById(id)
              .addEventListener("input", updateCopyButton);
          }
        });
        updateCopyButton(); // Initial check
      });
    </script>
  </body>
</html>
