<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØºÛŒÛŒØ± Ø´Ù…Ø§Ø±Ù‡ - ÙˆÛŒ Ù‡Ø§Ø¨</title>
    <style>
      :root {
        --primary-color: #00ae70;
        --primary-dark: #089863;
        --primary-light: #e6f7f2;
        --bg-color: #f8fcf9;
        --text-color: #222;
        --secondary-text-color: #555;
        --card-bg: #ffffff;
        --header-text: #ffffff;
        --shadow-color-light: rgba(0, 174, 112, 0.07);
        --shadow-color-medium: rgba(0, 174, 112, 0.12);
        --danger-color: #d93025;
        --danger-bg: #fce8e6;
        --info-color: #1a73e8;
        --info-bg: #e8f0fe;
        --border-radius: 0.75rem;
        --border-color: #e9e9e9;
      }
      @font-face {
        font-family: "Vazirmatn";
        src: url("/assets/fonts/Vazirmatn[wght].ttf") format("truetype");
        font-weight: 100 900;
        font-display: swap;
      }
      *,
      *::before,
      *::after {
        font-family: "Vazirmatn", sans-serif;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        direction: rtl;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header,
      footer {
        background: var(--primary-color);
        color: var(--header-text);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px var(--shadow-color-light);
        position: relative;
        z-index: 10;
        flex-shrink: 0;
      }
      header {
        height: 70px;
      }
      header h1 {
        font-size: 1.2rem;
        font-weight: 700;
      }
      footer {
        height: 60px;
        font-size: 0.85rem;
        margin-top: auto;
      }
      main {
        flex-grow: 1;
        padding: 2rem;
        max-width: 900px;
        width: 100%;
        margin: 0 auto;
      }
      a {
        text-decoration: none;
        transition: all 0.2s ease-in-out;
      }
      .form-card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px var(--shadow-color-light);
        overflow: hidden;
      }
      .form-card h2 {
        font-size: 1.2rem;
        font-weight: 700;
        padding: 1rem 1.5rem;
        background-color: var(--bg-color);
        color: var(--primary-dark);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .form-card .card-content {
        padding: 1.5rem;
      }
      .form-section {
        margin-bottom: 2rem;
        border-bottom: 1px dashed var(--border-color);
        padding-bottom: 2rem;
      }
      .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.6rem;
        font-weight: 600;
        font-size: 1rem;
        color: var(--secondary-text-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      input,
      textarea {
        width: 100%;
        font-size: 1rem;
        padding: 0.7em 1em;
        border-radius: 0.6em;
        border: 1.5px solid #ddd;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
        background-color: #fff;
      }
      input:focus,
      textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 174, 112, 0.15);
      }
      input::placeholder,
      textarea::placeholder {
        color: #aaa;
      }
      textarea {
        height: 100px;
        resize: vertical;
      }
      input[inputmode="numeric"] {
        direction: ltr;
        text-align: left;
      }
      .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        padding: 0.8rem 1rem;
        border: none;
        border-radius: 0.6rem;
        font-size: 1rem;
        font-weight: 600;
        color: var(--header-text);
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      }
      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: var(--primary-color);
      }
      .btn-primary:hover:not(:disabled) {
        background-color: var(--primary-dark);
      }
      .btn-info {
        background-color: var(--info-color);
      }
      .btn-info:hover:not(:disabled) {
        background-color: #1558c0;
      }
      .btn-danger {
        background-color: var(--danger-color);
      }
      .btn-danger:hover:not(:disabled) {
        background-color: #c02717;
      }
      .btn:disabled {
        background-color: #ccc;
        color: #888;
        cursor: not-allowed;
      }
      #autoFillBtn {
        margin-top: 0.75rem;
      }
      #autoFillBtn:hover {
        transform: translateY(-2px);
      }
      .input-message,
      .result {
        border-radius: var(--border-radius);
        padding: 0.8rem 1.2rem;
        line-height: 1.6;
        border: 1px solid transparent;
        border-inline-start-width: 4px;
        margin-top: 0.5rem;
        font-size: 0.9rem;
        font-weight: 500;
        display: none;
      }
      .input-message.success,
      .result.success {
        display: block;
        background-color: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-dark);
      }
      .input-message.error,
      .result.error {
        display: block;
        background-color: var(--danger-bg);
        border-color: var(--danger-color);
        color: var(--danger-color);
      }
      .result {
        margin-top: 1.5rem;
        text-align: center;
      }
      .back-link {
        display: inline-block;
        margin-top: 2rem;
        color: var(--primary-dark);
        font-weight: 500;
        text-align: center;
        width: 100%;
      }
      .back-link:hover {
        color: var(--primary-color);
        text-decoration: underline;
      }
      .input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }
      .input-wrapper input {
        padding-left: 45px;
      }
      .copy-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--secondary-text-color);
        font-size: 1.1rem;
        transition: all 0.2s ease-in-out;
        padding: 5px;
        border-radius: 50%;
        user-select: none; /* Prevent text selection */
        line-height: 1;
      }
      .copy-icon:hover {
        transform: translateY(-50%) scale(1.1);
      }
      .copy-icon.copied {
        color: var(--primary-dark);
      }
      @media (max-width: 768px) {
        main {
          padding: 1.5rem;
        }
        .form-card h2 {
          padding: 0.8rem 1rem;
          font-size: 1.1rem;
        }
        .form-card .card-content {
          padding: 1rem;
        }
        .form-row,
        .button-group {
          grid-template-columns: 1fr;
          gap: 0;
        }
        .form-group {
          margin-bottom: 1.2rem;
        }
        .button-group .btn {
          margin-top: 0.5rem;
        }
        .button-group .btn:first-child {
          margin-top: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="header-placeholder"></div>
    <main>
      <div class="form-card">
        <h2>ğŸ”„ Ø§Ø¨Ø²Ø§Ø± ØªØºÛŒÛŒØ± Ø´Ù…Ø§Ø±Ù‡</h2>
        <div class="card-content">
          <div>
            <div class="form-section">
              <div class="form-group" style="margin-bottom: 0">
                <label for="autoFillInput">âœ¨ ØªÚ©Ù…ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø±ÙˆÛŒ ØªÛŒÚ©Øª</label>
                <textarea
                  id="autoFillInput"
                  placeholder="Ù…ØªÙ† ØªÛŒÚ©Øª Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
                  aria-label="ÙˆØ±ÙˆØ¯ Ù…ØªÙ† ØªÛŒÚ©Øª Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ±Ù…"
                ></textarea>
              </div>
              <button
                class="btn btn-info"
                id="autoFillBtn"
                type="button"
                onclick="autoFillForm()"
              >
                Ù¾Ø± Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ±Ù…
              </button>
            </div>
            <div class="form-section">
              <div class="form-row">
                <div class="form-group">
                  <label for="nameInput">ğŸ‘¤ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="nameInput"
                      placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±"
                      autocomplete="off"
                      aria-label="ÙˆØ±ÙˆØ¯ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('nameInput')"
                      title="Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†"
                      >ğŸ“‹</span
                    >
                  </div>
                </div>
                <div class="form-group">
                  <label for="nationalIdInput">ğŸ’³ Ú©Ø¯Ù…Ù„ÛŒ</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="nationalIdInput"
                      placeholder="--- ------ -"
                      autocomplete="off"
                      maxlength="12"
                      inputmode="numeric"
                      aria-label="ÙˆØ±ÙˆØ¯ Ú©Ø¯Ù…Ù„ÛŒ"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('nationalIdInput')"
                      title="Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†"
                      >ğŸ“‹</span
                    >
                  </div>
                  <div id="nationalIdMessage" class="input-message"></div>
                  <div
                    id="provinceDisplay"
                    class="input-message success"
                    style="display: none"
                  ></div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="oldNumberInput">ğŸ“± Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø¨Ù„ÛŒ</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="oldNumberInput"
                      placeholder="---- --- ----"
                      autocomplete="off"
                      maxlength="13"
                      inputmode="numeric"
                      aria-label="ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø¨Ù„ÛŒ"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('oldNumberInput')"
                      title="Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†"
                      >ğŸ“‹</span
                    >
                  </div>
                  <div id="oldNumberMessage" class="input-message"></div>
                </div>
                <div class="form-group">
                  <label for="newNumberInput">ğŸ“² Ø´Ù…Ø§Ø±Ù‡ Ø¬Ø¯ÛŒØ¯</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="newNumberInput"
                      placeholder="---- --- ----"
                      autocomplete="off"
                      maxlength="13"
                      inputmode="numeric"
                      aria-label="ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§Ø±Ù‡ Ø¬Ø¯ÛŒØ¯"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('newNumberInput')"
                      title="Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†"
                      >ğŸ“‹</span
                    >
                  </div>
                  <div id="newNumberMessage" class="input-message"></div>
                </div>
              </div>
            </div>
            <div class="button-group">
              <button
                class="btn btn-danger"
                type="button"
                onclick="clearForm()"
              >
                ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
              </button>
              <button
                class="btn btn-primary"
                id="copyBtn"
                onclick="copyRequest()"
                disabled
              >
                ğŸ“„ Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª
              </button>
            </div>
            <div
              id="text-display-section"
              style="display: none; margin-top: 1.5rem"
            >
              <label
                for="requestTextOutput"
                style="font-size: 0.9rem; color: var(--primary-dark)"
                >Ù…ØªÙ† Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø¯Ø³ØªÛŒ:</label
              >
              <textarea
                id="requestTextOutput"
                readonly
                style="
                  width: 100%;
                  height: 130px;
                  margin-top: 0.5rem;
                  background-color: var(--primary-light);
                  color: var(--text-color);
                  border: 1px solid var(--primary-color);
                  padding: 0.75rem;
                  line-height: 1.6;
                  white-space: pre-wrap;
                  resize: vertical;
                "
              ></textarea>
            </div>
            <div id="copyResult" class="result"></div>
          </div>
        </div>
      </div>
      <a href="/index.html" class="back-link">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
    </main>
    <div id="footer-placeholder"></div>
    <script src="/js/header.js"></script>
    <script>
      function copyField(inputId) {
        const input = document.getElementById(inputId);
        const valueToCopy = input.value.replace(/\s/g, "").trim();
        const icon = input.nextElementSibling;

        if (!valueToCopy) {
          icon.innerText = "â—";
          icon.classList.add("copied");
          setTimeout(() => {
            icon.innerText = "ğŸ“‹";
            icon.classList.remove("copied");
          }, 1500);
          return;
        }

        navigator.clipboard
          .writeText(valueToCopy)
          .then(() => {
            icon.innerText = "âœ…";
            icon.classList.add("copied");
            setTimeout(() => {
              icon.innerText = "ğŸ“‹";
              icon.classList.remove("copied");
            }, 1500);
          })
          .catch((err) => {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ†: ", err);
            icon.innerText = "âŒ";
            icon.classList.add("copied");
            setTimeout(() => {
              icon.innerText = "ğŸ“‹";
              icon.classList.remove("copied");
            }, 1500);
          });
      }

      function normalizeDigits(text) {
        return text.replace(/[Û°-Û¹]/g, (d) =>
          "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d).toString()
        );
      }

      function formatMobileNumber(input) {
        let value = input.value.replace(/[^\d]/g, "");
        value = value.slice(0, 11);
        if (value.length >= 8) {
          input.value = value
            .replace(/(\d{4})(\d{3})(\d{0,4})/, "$1 $2 $3")
            .trim();
        } else if (value.length >= 5) {
          input.value = value.replace(/(\d{4})(\d{0,3})/, "$1 $2").trim();
        } else {
          input.value = value;
        }
        return value;
      }

      function formatNationalId(input) {
        let value = input.value.replace(/[^\d]/g, "").slice(0, 10);
        if (value.length >= 10) {
          input.value = value.replace(/(\d{3})(\d{6})(\d{1})/, "$1 $2 $3");
        } else if (value.length > 3) {
          input.value = value.replace(/(\d{3})(\d{0,6})/, "$1 $2");
        } else {
          input.value = value;
        }
        return value;
      }

      document
        .getElementById("oldNumberInput")
        .addEventListener("input", function (e) {
          const pureValue = formatMobileNumber(e.target);
          validatePhone(e.target, "oldNumberMessage", pureValue);
          updateCopyButton();
        });

      document
        .getElementById("newNumberInput")
        .addEventListener("input", function (e) {
          const pureValue = formatMobileNumber(e.target);
          validatePhone(e.target, "newNumberMessage", pureValue);
          updateCopyButton();
        });

      document
        .getElementById("nationalIdInput")
        .addEventListener("input", function (e) {
          const pureValue = formatNationalId(e.target);
          validateNationalId(e.target, "nationalIdMessage", pureValue);
          updateProvinceDisplay(pureValue);
          updateCopyButton();
        });

      document
        .getElementById("nameInput")
        .addEventListener("input", function (e) {
          let newValue = e.target.value.replace(/[0-9Û°-Û¹]/g, "");
          if (e.target.value !== newValue) {
            e.target.value = newValue;
          }
          updateCopyButton();
        });

      function validatePhone(input, msgId, pureValue) {
        const msgBox = document.getElementById(msgId);
        input.classList.remove("input-error");
        msgBox.className = "input-message";
        msgBox.innerText = "";
        let val =
          pureValue !== undefined
            ? pureValue
            : input.value.replace(/[^\d]/g, "");
        if (val && !/^09\d{9}$/.test(val)) {
          msgBox.innerText = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Û±Û± Ø±Ù‚Ù… Ùˆ Ø¨Ø§ Û°Û¹ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        return true;
      }

      function isValidIranianNationalCode(input) {
        if (!/^\d{10}$/.test(input)) return false;
        if (/^(\d)\1{9}$/.test(input)) return false;
        let check = +input[9];
        let sum = 0;
        for (let i = 0; i < 9; ++i) {
          sum += +input[i] * (10 - i);
        }
        let rem = sum % 11;
        return (rem < 2 && check == rem) || (rem >= 2 && check == 11 - rem);
      }

      function validateNationalId(input, msgId, pureValue) {
        const msgBox = document.getElementById(msgId);
        input.classList.remove("input-error");
        msgBox.className = "input-message";
        msgBox.innerText = "";
        let val =
          pureValue !== undefined
            ? pureValue
            : input.value.replace(/[^\d]/g, "");
        if (val && !/^\d{10}$/.test(val)) {
          msgBox.innerText = "Ú©Ø¯Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ Û±Û° Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        if (val && !isValidIranianNationalCode(val)) {
          msgBox.innerText = "Ú©Ø¯Ù…Ù„ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        if (val && isValidIranianNationalCode(val)) {
          msgBox.innerText = "Ú©Ø¯Ù…Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.";
          msgBox.classList.add("success");
        }
        return true;
      }

      function checkDuplicateNumbers() {
        const oldNumber = document
          .getElementById("oldNumberInput")
          .value.replace(/[^\d]/g, "");
        const newNumber = document
          .getElementById("newNumberInput")
          .value.replace(/[^\d]/g, "");
        const msgBox = document.getElementById("newNumberMessage");
        if (oldNumber && newNumber && oldNumber === newNumber) {
          msgBox.innerText = "Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø¨Ù„ÛŒ Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ù†Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯.";
          msgBox.className = "input-message error";
          document
            .getElementById("newNumberInput")
            .classList.add("input-error");
          return false;
        }
        if (msgBox.innerText === "Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø¨Ù„ÛŒ Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ù†Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯.") {
          msgBox.innerText = "";
          msgBox.className = "input-message";
          document
            .getElementById("newNumberInput")
            .classList.remove("input-error");
        }
        return true;
      }

      function updateCopyButton() {
        const newNumberInput = document.getElementById("newNumberInput");
        const nationalIdInput = document.getElementById("nationalIdInput");
        const newNumValid = validatePhone(newNumberInput, "newNumberMessage");
        const nationalIdValid = validateNationalId(
          nationalIdInput,
          "nationalIdMessage"
        );
        const duplicateCheck = checkDuplicateNumbers();
        const btn = document.getElementById("copyBtn");
        if (
          newNumberInput.value.trim() &&
          newNumValid &&
          nationalIdInput.value.trim() &&
          nationalIdValid &&
          duplicateCheck
        ) {
          btn.disabled = false;
        } else {
          btn.disabled = true;
        }
      }

      /**
       * START: FUNCTION MODIFIED
       * Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø¨Ù‡ Ø¬Ø§ÛŒ Ú©Ù¾ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª
       */
      function copyRequest() {
        const name = document.getElementById("nameInput").value.trim();
        const oldNumber = document
          .getElementById("oldNumberInput")
          .value.replace(/[^\d]/g, "");
        const nationalId = document
          .getElementById("nationalIdInput")
          .value.replace(/[^\d]/g, "");
        const newNumber = document
          .getElementById("newNumberInput")
          .value.replace(/[^\d]/g, "");

        const text =
          "Ø¨Ø§ Ø³Ù„Ø§Ù…\n" +
          "Ú©Ø§Ø±Ø¨Ø± " +
          (name ? name : "Ù†Ø§Ù…Ø´Ø®Øµ") +
          " Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ " +
          (oldNumber ? oldNumber : "Ù†Ø§Ù…Ø´Ø®Øµ") +
          " Ùˆ Ú©Ø¯Ù…Ù„ÛŒ " +
          (nationalId ? nationalId : "Ù†Ø§Ù…Ø´Ø®Øµ") +
          " Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØºÛŒÛŒØ± Ø´Ù…Ø§Ø±Ù‡ Ø¨Ù‡ " +
          (newNumber ? newNumber : "Ù†Ø§Ù…Ø´Ø®Øµ") +
          " Ø±Ø§ Ø¯Ø§Ø±Ø¯.";

        const displaySection = document.getElementById("text-display-section");
        const outputTextarea = document.getElementById("requestTextOutput");
        const res = document.getElementById("copyResult");

        // Ù…ØªÙ† Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù‡ Ùˆ Ø¢Ù† Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
        outputTextarea.value = text;
        displaySection.style.display = "block";

        // Ù…ØªÙ† Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø¢Ø³Ø§Ù† ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ (select) Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        outputTextarea.focus();
        outputTextarea.select();

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ØªØ§ÛŒÛŒØ¯
        res.innerText = "âœ… Ù…ØªÙ† Ø¬Ù‡Øª Ú©Ù¾ÛŒ Ø¯Ø³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯.";
        res.className = "result success";
        res.style.display = "block";
        setTimeout(() => {
          res.style.display = "none";
        }, 2500);
      }
      /**
       * END: FUNCTION MODIFIED
       */

      function clearForm() {
        document.getElementById("autoFillInput").value = "";
        document.getElementById("nameInput").value = "";
        document.getElementById("oldNumberInput").value = "";
        document.getElementById("nationalIdInput").value = "";
        document.getElementById("newNumberInput").value = "";
        document.getElementById("oldNumberMessage").innerText = "";
        document.getElementById("oldNumberMessage").className = "input-message";
        document.getElementById("nationalIdMessage").innerText = "";
        document.getElementById("nationalIdMessage").className =
          "input-message";
        document.getElementById("newNumberMessage").innerText = "";
        document.getElementById("newNumberMessage").className = "input-message";
        const provinceDiv = document.getElementById("provinceDisplay");
        provinceDiv.style.display = "none";
        provinceDiv.innerText = "";
        document.getElementById("copyResult").innerText = "";
        document.getElementById("copyResult").style.display = "none";

        // START: Ø®Ø·ÙˆØ· Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ú©Ø§Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ†
        document.getElementById("text-display-section").style.display = "none";
        document.getElementById("requestTextOutput").value = "";
        // END: Ø®Ø·ÙˆØ· Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡

        document
          .getElementById("oldNumberInput")
          .classList.remove("input-error");
        document
          .getElementById("nationalIdInput")
          .classList.remove("input-error");
        document
          .getElementById("newNumberInput")
          .classList.remove("input-error");
        updateCopyButton();
      }

      updateCopyButton();

      // --- START: Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ ---
      fetch("data/name.json")
        .then((res) => res.json())
        .then((data) => {
          nameList = data; // Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø± Ù…ØªØºÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        })
        .catch((err) => {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ name.json:", err);
        });

      function updateProvinceDisplay(pureValue) {
        const provinceDiv = document.getElementById("provinceDisplay");
        if (!pureValue || pureValue.length < 3) {
          provinceDiv.style.display = "none";
          provinceDiv.innerText = "";
          return;
        }
        const prefix = pureValue.slice(0, 3);

        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ API Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø³ØªØ§Ù†
        fetch(`/api/get_province_info.php?code=${prefix}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø± Ù‡Ø± ØµÙˆØ±Øª
            provinceDiv.style.display = "block";

            if (data && data.province && data.city) {
              // Ø§Ú¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯
              provinceDiv.innerText = `Ø§Ø³ØªØ§Ù† Ù…Ø­Ù„ ØµØ¯ÙˆØ±: ${data.province} | Ø´Ù‡Ø± Ù…Ø­Ù„ ØµØ¯ÙˆØ±: ${data.city}`;
              provinceDiv.className = "input-message success"; // Ø§Ø³ØªØ§ÛŒÙ„ Ù…ÙˆÙÙ‚ÛŒØª
            } else {
              // Ø§Ú¯Ø± Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
              provinceDiv.innerText =
                "âŒ Ù¾ÛŒØ´â€ŒØ´Ù…Ø§Ø±Ù‡ Ú©Ø¯Ù…Ù„ÛŒ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.";
              provinceDiv.className = "input-message error"; // Ø§Ø³ØªØ§ÛŒÙ„ Ø®Ø·Ø§
            }
          })
          .catch((error) => {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø³ØªØ§Ù†:", error);
            provinceDiv.style.display = "block";
            provinceDiv.innerText = "âš ï¸ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯.";
            provinceDiv.className = "input-message error";
          });
      }

      function autoFillForm() {
        const rawText = document.getElementById("autoFillInput").value.trim();
        if (!rawText) {
          alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù…ØªÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }
        const text = normalizeDigits(rawText);
        const oldInput = document.getElementById("oldNumberInput");
        oldInput.value = "";
        oldInput.classList.remove("input-error");
        const oldMsg = document.getElementById("oldNumberMessage");
        oldMsg.innerText = "";
        oldMsg.className = "input-message";
        const newInput = document.getElementById("newNumberInput");
        newInput.value = "";
        newInput.classList.remove("input-error");
        const newMsg = document.getElementById("newNumberMessage");
        newMsg.innerText = "";
        newMsg.className = "input-message";
        const nationalInput = document.getElementById("nationalIdInput");
        nationalInput.value = "";
        nationalInput.classList.remove("input-error");
        const nationalMsg = document.getElementById("nationalIdMessage");
        nationalMsg.innerText = "";
        nationalMsg.className = "input-message";
        const provinceDiv = document.getElementById("provinceDisplay");
        provinceDiv.style.display = "none";
        provinceDiv.innerText = "";

        // Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù…
        const nameInput = document.getElementById("nameInput");
        nameInput.value = ""; // Ø§Ø¨ØªØ¯Ø§ ÙÛŒÙ„Ø¯ Ù†Ø§Ù… Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…

        if (nameList.length > 0) {
          // ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
          const words = text.replace(/[.,!?]/g, "").split(/\s+/); // Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Ú©Ù„Ù…Ø§Øª ØªÙ‚Ø³ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          let foundName = "";

          for (let i = 0; i < words.length; i++) {
            // Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ù„Ù…Ù‡ ÙØ¹Ù„ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ø§Ø³Ø§Ù…ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
            if (nameList.includes(words[i])) {
              // Ø§Ú¯Ø± Ø§Ø³Ù… Ù¾ÛŒØ¯Ø§ Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ú©Ù„Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ (ÙØ§Ù…ÛŒÙ„ÛŒ) Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
              foundName = words[i];
              if (i + 1 < words.length) {
                // Ù…Ø·Ù…Ø¦Ù† Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ… Ú©Ù„Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                foundName += " " + words[i + 1];
              }
              break; // Ø¨Ø¹Ø¯ Ø§Ø² Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø§Ø³Ù…ØŒ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ…
            }
          }

          if (foundName) {
            nameInput.value = foundName; // Ù…Ù‚Ø¯Ø§Ø± ÙÛŒÙ„Ø¯ Ù†Ø§Ù… Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          }
        }

        const phoneMatches = text.match(/09\d{9}/g) || [];
        const nationalIdMatches = text.match(/\b\d{10}\b/g) || [];
        if (phoneMatches.length === 1) {
          newInput.value = phoneMatches[0];
          formatMobileNumber(newInput);
          validatePhone(newInput, "newNumberMessage", phoneMatches[0]);
        } else if (phoneMatches.length >= 2) {
          oldInput.value = phoneMatches[0];
          formatMobileNumber(oldInput);
          validatePhone(oldInput, "oldNumberMessage", phoneMatches[0]);
          newInput.value = phoneMatches[1];
          formatMobileNumber(newInput);
          validatePhone(newInput, "newNumberMessage", phoneMatches[1]);
        }
        if (nationalIdMatches.length >= 1) {
          nationalInput.value = nationalIdMatches[0];
          formatNationalId(nationalInput);
          validateNationalId(
            nationalInput,
            "nationalIdMessage",
            nationalIdMatches[0]
          );
          updateProvinceDisplay(nationalIdMatches[0]);
        }
        updateCopyButton();
      }
    </script>
  </body>
</html>
