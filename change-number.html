<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÿ™ÿ∫€å€åÿ± ÿ¥ŸÖÿßÿ±Ÿá - Ÿà€å Ÿáÿßÿ®</title>
    <style>
      :root {
        --primary-color: #00ae70;
        --primary-dark: #089863;
        --primary-light: #e6f7f2;
        --bg-color: #f8fcf9;
        --text-color: #222;
        --secondary-text-color: #555;
        --card-bg: #ffffff;
        --header-text: #ffffff;
        --shadow-color-light: rgba(0, 174, 112, 0.07);
        --shadow-color-medium: rgba(0, 174, 112, 0.12);
        --danger-color: #d93025;
        --danger-bg: #fce8e6;
        --info-color: #1a73e8;
        --info-bg: #e8f0fe;
        --border-radius: 0.75rem;
        --border-color: #e9e9e9;
      }
      @font-face {
        font-family: "Vazirmatn";
        src: url("/assets/fonts/Vazirmatn[wght].ttf") format("truetype");
        font-weight: 100 900;
        font-display: swap;
      }
      *,
      *::before,
      *::after {
        font-family: "Vazirmatn", sans-serif;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        direction: rtl;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header,
      footer {
        background: var(--primary-color);
        color: var(--header-text);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px var(--shadow-color-light);
        position: relative;
        z-index: 10;
        flex-shrink: 0;
      }
      header {
        height: 70px;
      }
      header h1 {
        font-size: 1.2rem;
        font-weight: 700;
      }
      footer {
        height: 60px;
        font-size: 0.85rem;
        margin-top: auto;
      }
      main {
        flex-grow: 1;
        padding: 2rem;
        max-width: 900px;
        width: 100%;
        margin: 0 auto;
      }
      a {
        text-decoration: none;
        transition: all 0.2s ease-in-out;
      }
      .form-card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 15px var(--shadow-color-light);
        overflow: hidden;
      }
      .form-card h2 {
        font-size: 1.2rem;
        font-weight: 700;
        padding: 1rem 1.5rem;
        background-color: var(--bg-color);
        color: var(--primary-dark);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .form-card .card-content {
        padding: 1.5rem;
      }
      .form-section {
        margin-bottom: 2rem;
        border-bottom: 1px dashed var(--border-color);
        padding-bottom: 2rem;
      }
      .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.6rem;
        font-weight: 600;
        font-size: 1rem;
        color: var(--secondary-text-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      input,
      textarea {
        width: 100%;
        font-size: 1rem;
        padding: 0.7em 1em;
        border-radius: 0.6em;
        border: 1.5px solid #ddd;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
        background-color: #fff;
      }
      input:focus,
      textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 174, 112, 0.15);
      }
      input::placeholder,
      textarea::placeholder {
        color: #aaa;
      }
      textarea {
        height: 100px;
        resize: vertical;
      }
      input[inputmode="numeric"] {
        direction: ltr;
        text-align: left;
      }
      .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        padding: 0.8rem 1rem;
        border: none;
        border-radius: 0.6rem;
        font-size: 1rem;
        font-weight: 600;
        color: var(--header-text);
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      }
      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: var(--primary-color);
      }
      .btn-primary:hover:not(:disabled) {
        background-color: var(--primary-dark);
      }
      .btn-info {
        background-color: var(--info-color);
      }
      .btn-info:hover:not(:disabled) {
        background-color: #1558c0;
      }
      .btn-danger {
        background-color: var(--danger-color);
      }
      .btn-danger:hover:not(:disabled) {
        background-color: #c02717;
      }
      .btn:disabled {
        background-color: #ccc;
        color: #888;
        cursor: not-allowed;
      }
      #autoFillBtn {
        margin-top: 0.75rem;
      }
      #autoFillBtn:hover {
        transform: translateY(-2px);
      }
      .input-message,
      .result {
        border-radius: var(--border-radius);
        padding: 0.8rem 1.2rem;
        line-height: 1.6;
        border: 1px solid transparent;
        border-inline-start-width: 4px;
        margin-top: 0.5rem;
        font-size: 0.9rem;
        font-weight: 500;
        display: none;
      }
      .input-message.success,
      .result.success {
        display: block;
        background-color: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-dark);
      }
      .input-message.error,
      .result.error {
        display: block;
        background-color: var(--danger-bg);
        border-color: var(--danger-color);
        color: var(--danger-color);
      }
      .result {
        margin-top: 1.5rem;
        text-align: center;
      }
      .back-link {
        display: inline-block;
        margin-top: 2rem;
        color: var(--primary-dark);
        font-weight: 500;
        text-align: center;
        width: 100%;
      }
      .back-link:hover {
        color: var(--primary-color);
        text-decoration: underline;
      }
      .input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }
      .input-wrapper input {
        padding-left: 45px;
      }
      .copy-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--secondary-text-color);
        font-size: 1.1rem;
        transition: all 0.2s ease-in-out;
        padding: 5px;
        border-radius: 50%;
        user-select: none; /* Prevent text selection */
        line-height: 1;
      }
      .copy-icon:hover {
        transform: translateY(-50%) scale(1.1);
      }
      .copy-icon.copied {
        color: var(--primary-dark);
      }
      @media (max-width: 768px) {
        main {
          padding: 1.5rem;
        }
        .form-card h2 {
          padding: 0.8rem 1rem;
          font-size: 1.1rem;
        }
        .form-card .card-content {
          padding: 1rem;
        }
        .form-row,
        .button-group {
          grid-template-columns: 1fr;
          gap: 0;
        }
        .form-group {
          margin-bottom: 1.2rem;
        }
        .button-group .btn {
          margin-top: 0.5rem;
        }
        .button-group .btn:first-child {
          margin-top: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="header-placeholder"></div>
    <main>
      <div class="form-card">
        <h2>üîÑ ÿßÿ®ÿ≤ÿßÿ± ÿ™ÿ∫€å€åÿ± ÿ¥ŸÖÿßÿ±Ÿá</h2>
        <div class="card-content">
          <div>
            <div class="form-section">
              <div class="form-group" style="margin-bottom: 0">
                <label for="autoFillInput">‚ú® ÿ™⁄©ŸÖ€åŸÑ ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿ≤ ÿ±Ÿà€å ÿ™€å⁄©ÿ™</label>
                <textarea
                  id="autoFillInput"
                  placeholder="ŸÖÿ™ŸÜ ÿ™€å⁄©ÿ™ ŸÖÿ¥ÿ™ÿ±€å ÿ±ÿß ÿß€åŸÜÿ¨ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ..."
                  aria-label="Ÿàÿ±ŸàÿØ ŸÖÿ™ŸÜ ÿ™€å⁄©ÿ™ ÿ®ÿ±ÿß€å ÿ™⁄©ŸÖ€åŸÑ ÿÆŸàÿØ⁄©ÿßÿ± ŸÅÿ±ŸÖ"
                ></textarea>
              </div>
              <button
                class="btn btn-info"
                id="autoFillBtn"
                type="button"
                onclick="autoFillForm()"
              >
                Ÿæÿ± ⁄©ÿ±ÿØŸÜ ÿÆŸàÿØ⁄©ÿßÿ± ŸÅÿ±ŸÖ
              </button>
            </div>
            <div class="form-section">
              <div class="form-row">
                <div class="form-group">
                  <label for="nameInput">üë§ ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="nameInput"
                      placeholder="ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±"
                      autocomplete="off"
                      aria-label="Ÿàÿ±ŸàÿØ ŸÜÿßŸÖ Ÿà ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('nameInput')"
                      title="⁄©Ÿæ€å ⁄©ÿ±ÿØŸÜ"
                      >üìã</span
                    >
                  </div>
                </div>
                <div class="form-group">
                  <label for="nationalIdInput">üí≥ ⁄©ÿØŸÖŸÑ€å</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="nationalIdInput"
                      placeholder="--- ------ -"
                      autocomplete="off"
                      maxlength="12"
                      inputmode="numeric"
                      aria-label="Ÿàÿ±ŸàÿØ ⁄©ÿØŸÖŸÑ€å"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('nationalIdInput')"
                      title="⁄©Ÿæ€å ⁄©ÿ±ÿØŸÜ"
                      >üìã</span
                    >
                  </div>
                  <div id="nationalIdMessage" class="input-message"></div>
                  <div
                    id="provinceDisplay"
                    class="input-message success"
                    style="display: none"
                  ></div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="oldNumberInput">üì± ÿ¥ŸÖÿßÿ±Ÿá ŸÇÿ®ŸÑ€å</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="oldNumberInput"
                      placeholder="---- --- ----"
                      autocomplete="off"
                      maxlength="13"
                      inputmode="numeric"
                      aria-label="Ÿàÿ±ŸàÿØ ÿ¥ŸÖÿßÿ±Ÿá ŸÇÿ®ŸÑ€å"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('oldNumberInput')"
                      title="⁄©Ÿæ€å ⁄©ÿ±ÿØŸÜ"
                      >üìã</span
                    >
                  </div>
                  <div id="oldNumberMessage" class="input-message"></div>
                </div>
                <div class="form-group">
                  <label for="newNumberInput">üì≤ ÿ¥ŸÖÿßÿ±Ÿá ÿ¨ÿØ€åÿØ</label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      id="newNumberInput"
                      placeholder="---- --- ----"
                      autocomplete="off"
                      maxlength="13"
                      inputmode="numeric"
                      aria-label="Ÿàÿ±ŸàÿØ ÿ¥ŸÖÿßÿ±Ÿá ÿ¨ÿØ€åÿØ"
                    />
                    <span
                      class="copy-icon"
                      onclick="copyField('newNumberInput')"
                      title="⁄©Ÿæ€å ⁄©ÿ±ÿØŸÜ"
                      >üìã</span
                    >
                  </div>
                  <div id="newNumberMessage" class="input-message"></div>
                </div>
              </div>
            </div>
            <div class="button-group">
              <button
                class="btn btn-danger"
                type="button"
                onclick="clearForm()"
              >
                üóëÔ∏è Ÿæÿß⁄© ⁄©ÿ±ÿØŸÜ ŸÅÿ±ŸÖ
              </button>
              <button
                class="btn btn-primary"
                id="copyBtn"
                onclick="copyRequest()"
                disabled
              >
                üìÑ ŸÜŸÖÿß€åÿ¥ ŸÖÿ™ŸÜ ÿØÿ±ÿÆŸàÿßÿ≥ÿ™
              </button>
            </div>
            <div
              id="text-display-section"
              style="display: none; margin-top: 1.5rem"
            >
              <label
                for="requestTextOutput"
                style="font-size: 0.9rem; color: var(--primary-dark)"
                >ŸÖÿ™ŸÜ ÿ¢ŸÖÿßÿØŸá ÿ¥ÿØŸá ÿ®ÿ±ÿß€å ⁄©Ÿæ€å ÿØÿ≥ÿ™€å:</label
              >
              <textarea
                id="requestTextOutput"
                readonly
                style="
                  width: 100%;
                  height: 130px;
                  margin-top: 0.5rem;
                  background-color: var(--primary-light);
                  color: var(--text-color);
                  border: 1px solid var(--primary-color);
                  padding: 0.75rem;
                  line-height: 1.6;
                  white-space: pre-wrap;
                  resize: vertical;
                "
              ></textarea>
            </div>
            <div id="copyResult" class="result"></div>
          </div>
        </div>
      </div>
      <a href="/index.html" class="back-link">üè† ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ÿ®Ÿá ÿµŸÅÿ≠Ÿá ÿßÿµŸÑ€å</a>
    </main>
    <div id="footer-placeholder"></div>
    <script src="/js/header.js"></script>
    <script>
      function copyField(inputId) {
        const input = document.getElementById(inputId);
        const valueToCopy = input.value.replace(/\s/g, "").trim();
        const icon = input.nextElementSibling;

        if (!valueToCopy) {
          icon.innerText = "‚ùó";
          icon.classList.add("copied");
          setTimeout(() => {
            icon.innerText = "üìã";
            icon.classList.remove("copied");
          }, 1500);
          return;
        }

        navigator.clipboard
          .writeText(valueToCopy)
          .then(() => {
            icon.innerText = "‚úÖ";
            icon.classList.add("copied");
            setTimeout(() => {
              icon.innerText = "üìã";
              icon.classList.remove("copied");
            }, 1500);
          })
          .catch((err) => {
            console.error("ÿÆÿ∑ÿß ÿØÿ± ⁄©Ÿæ€å ⁄©ÿ±ÿØŸÜ ŸÖÿ™ŸÜ: ", err);
            icon.innerText = "‚ùå";
            icon.classList.add("copied");
            setTimeout(() => {
              icon.innerText = "üìã";
              icon.classList.remove("copied");
            }, 1500);
          });
      }

      function normalizeDigits(text) {
        return text.replace(/[€∞-€π]/g, (d) =>
          "€∞€±€≤€≥€¥€µ€∂€∑€∏€π".indexOf(d).toString()
        );
      }

      function formatMobileNumber(input) {
        let value = input.value.replace(/[^\d]/g, "");
        value = value.slice(0, 11);
        if (value.length >= 8) {
          input.value = value
            .replace(/(\d{4})(\d{3})(\d{0,4})/, "$1 $2 $3")
            .trim();
        } else if (value.length >= 5) {
          input.value = value.replace(/(\d{4})(\d{0,3})/, "$1 $2").trim();
        } else {
          input.value = value;
        }
        return value;
      }

      function formatNationalId(input) {
        let value = input.value.replace(/[^\d]/g, "").slice(0, 10);
        if (value.length >= 10) {
          input.value = value.replace(/(\d{3})(\d{6})(\d{1})/, "$1 $2 $3");
        } else if (value.length > 3) {
          input.value = value.replace(/(\d{3})(\d{0,6})/, "$1 $2");
        } else {
          input.value = value;
        }
        return value;
      }

      document
        .getElementById("oldNumberInput")
        .addEventListener("input", function (e) {
          const pureValue = formatMobileNumber(e.target);
          validatePhone(e.target, "oldNumberMessage", pureValue);
          updateCopyButton();
        });

      document
        .getElementById("newNumberInput")
        .addEventListener("input", function (e) {
          const pureValue = formatMobileNumber(e.target);
          validatePhone(e.target, "newNumberMessage", pureValue);
          updateCopyButton();
        });

      document
        .getElementById("nationalIdInput")
        .addEventListener("input", function (e) {
          const pureValue = formatNationalId(e.target);
          validateNationalId(e.target, "nationalIdMessage", pureValue);
          updateProvinceDisplay(pureValue);
          updateCopyButton();
        });

      document
        .getElementById("nameInput")
        .addEventListener("input", function (e) {
          let newValue = e.target.value.replace(/[0-9€∞-€π]/g, "");
          if (e.target.value !== newValue) {
            e.target.value = newValue;
          }
          updateCopyButton();
        });

      function validatePhone(input, msgId, pureValue) {
        const msgBox = document.getElementById(msgId);
        input.classList.remove("input-error");
        msgBox.className = "input-message";
        msgBox.innerText = "";
        let val =
          pureValue !== undefined
            ? pureValue
            : input.value.replace(/[^\d]/g, "");
        if (val && !/^09\d{9}$/.test(val)) {
          msgBox.innerText = "ÿ¥ŸÖÿßÿ±Ÿá ŸÖŸàÿ®ÿß€åŸÑ ÿ®ÿß€åÿØ €±€± ÿ±ŸÇŸÖ Ÿà ÿ®ÿß €∞€π ÿ¥ÿ±Ÿàÿπ ÿ¥ŸàÿØ.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        return true;
      }

      function isValidIranianNationalCode(input) {
        if (!/^\d{10}$/.test(input)) return false;
        if (/^(\d)\1{9}$/.test(input)) return false;
        let check = +input[9];
        let sum = 0;
        for (let i = 0; i < 9; ++i) {
          sum += +input[i] * (10 - i);
        }
        let rem = sum % 11;
        return (rem < 2 && check == rem) || (rem >= 2 && check == 11 - rem);
      }

      function validateNationalId(input, msgId, pureValue) {
        const msgBox = document.getElementById(msgId);
        input.classList.remove("input-error");
        msgBox.className = "input-message";
        msgBox.innerText = "";
        let val =
          pureValue !== undefined
            ? pureValue
            : input.value.replace(/[^\d]/g, "");
        if (val && !/^\d{10}$/.test(val)) {
          msgBox.innerText = "⁄©ÿØŸÖŸÑ€å ÿ®ÿß€åÿØ €±€∞ ÿ±ŸÇŸÖ ÿ®ÿßÿ¥ÿØ.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        if (val && !isValidIranianNationalCode(val)) {
          msgBox.innerText = "⁄©ÿØŸÖŸÑ€å Ÿàÿßÿ±ÿØ ÿ¥ÿØŸá ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™.";
          msgBox.classList.add("error");
          input.classList.add("input-error");
          return false;
        }
        if (val && isValidIranianNationalCode(val)) {
          msgBox.innerText = "⁄©ÿØŸÖŸÑ€å ŸÖÿπÿ™ÿ®ÿ± ÿßÿ≥ÿ™.";
          msgBox.classList.add("success");
        }
        return true;
      }

      function checkDuplicateNumbers() {
        const oldNumber = document
          .getElementById("oldNumberInput")
          .value.replace(/[^\d]/g, "");
        const newNumber = document
          .getElementById("newNumberInput")
          .value.replace(/[^\d]/g, "");
        const msgBox = document.getElementById("newNumberMessage");
        if (oldNumber && newNumber && oldNumber === newNumber) {
          msgBox.innerText = "ÿ¥ŸÖÿßÿ±Ÿá ŸÇÿ®ŸÑ€å Ÿà ÿ¥ŸÖÿßÿ±Ÿá ÿ¨ÿØ€åÿØ ŸÜÿ®ÿß€åÿØ €å⁄©ÿ≥ÿßŸÜ ÿ®ÿßÿ¥ŸÜÿØ.";
          msgBox.className = "input-message error";
          document
            .getElementById("newNumberInput")
            .classList.add("input-error");
          return false;
        }
        if (msgBox.innerText === "ÿ¥ŸÖÿßÿ±Ÿá ŸÇÿ®ŸÑ€å Ÿà ÿ¥ŸÖÿßÿ±Ÿá ÿ¨ÿØ€åÿØ ŸÜÿ®ÿß€åÿØ €å⁄©ÿ≥ÿßŸÜ ÿ®ÿßÿ¥ŸÜÿØ.") {
          msgBox.innerText = "";
          msgBox.className = "input-message";
          document
            .getElementById("newNumberInput")
            .classList.remove("input-error");
        }
        return true;
      }

      function updateCopyButton() {
        const newNumberInput = document.getElementById("newNumberInput");
        const nationalIdInput = document.getElementById("nationalIdInput");
        const newNumValid = validatePhone(newNumberInput, "newNumberMessage");
        const nationalIdValid = validateNationalId(
          nationalIdInput,
          "nationalIdMessage"
        );
        const duplicateCheck = checkDuplicateNumbers();
        const btn = document.getElementById("copyBtn");
        if (
          newNumberInput.value.trim() &&
          newNumValid &&
          nationalIdInput.value.trim() &&
          nationalIdValid &&
          duplicateCheck
        ) {
          btn.disabled = false;
        } else {
          btn.disabled = true;
        }
      }

      /**
       * START: FUNCTION MODIFIED
       * ÿß€åŸÜ ÿ™ÿßÿ®ÿπ ÿ®ÿ±ÿß€å ŸÜŸÖÿß€åÿ¥ ŸÖÿ™ŸÜ ÿ®Ÿá ÿ¨ÿß€å ⁄©Ÿæ€å ŸÖÿ≥ÿ™ŸÇ€åŸÖ ÿ™ÿ∫€å€åÿ± ⁄©ÿ±ÿØŸá ÿßÿ≥ÿ™
       */
      function copyRequest() {
        const name = document.getElementById("nameInput").value.trim();
        const oldNumber = document
          .getElementById("oldNumberInput")
          .value.replace(/[^\d]/g, "");
        const nationalId = document
          .getElementById("nationalIdInput")
          .value.replace(/[^\d]/g, "");
        const newNumber = document
          .getElementById("newNumberInput")
          .value.replace(/[^\d]/g, "");

        const text =
          "ÿ®ÿß ÿ≥ŸÑÿßŸÖ\n" +
          "⁄©ÿßÿ±ÿ®ÿ± " +
          (name ? name : "ŸÜÿßŸÖÿ¥ÿÆÿµ") +
          " ÿ®ÿß ÿ¥ŸÖÿßÿ±Ÿá ŸÖŸàÿ®ÿß€åŸÑ " +
          (oldNumber ? oldNumber : "ŸÜÿßŸÖÿ¥ÿÆÿµ") +
          " Ÿà ⁄©ÿØŸÖŸÑ€å " +
          (nationalId ? nationalId : "ŸÜÿßŸÖÿ¥ÿÆÿµ") +
          " ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ÿ™ÿ∫€å€åÿ± ÿ¥ŸÖÿßÿ±Ÿá ÿ®Ÿá " +
          (newNumber ? newNumber : "ŸÜÿßŸÖÿ¥ÿÆÿµ") +
          " ÿ±ÿß ÿØÿßÿ±ÿØ.";

        const displaySection = document.getElementById("text-display-section");
        const outputTextarea = document.getElementById("requestTextOutput");
        const res = document.getElementById("copyResult");

        // ŸÖÿ™ŸÜ ÿ±ÿß ÿØÿ± ⁄©ÿßÿØÿ± ŸÇÿ±ÿßÿ± ÿØÿßÿØŸá Ÿà ÿ¢ŸÜ ÿ±ÿß ŸÜŸÖÿß€åÿ¥ ŸÖ€å‚ÄåÿØŸáÿØ
        outputTextarea.value = text;
        displaySection.style.display = "block";

        // ŸÖÿ™ŸÜ ÿ±ÿß ÿ®ÿ±ÿß€å ⁄©Ÿæ€å ÿ¢ÿ≥ÿßŸÜ ÿ™Ÿàÿ≥ÿ∑ ⁄©ÿßÿ±ÿ®ÿ± ÿßŸÜÿ™ÿÆÿßÿ® (select) ŸÖ€å‚Äå⁄©ŸÜÿØ
        outputTextarea.focus();
        outputTextarea.select();

        // ŸÜŸÖÿß€åÿ¥ Ÿæ€åÿßŸÖ ÿ™ÿß€å€åÿØ
        res.innerText = "‚úÖ ŸÖÿ™ŸÜ ÿ¨Ÿáÿ™ ⁄©Ÿæ€å ÿØÿ≥ÿ™€å ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ÿ¥ÿØ.";
        res.className = "result success";
        res.style.display = "block";
        setTimeout(() => {
          res.style.display = "none";
        }, 2500);
      }
      /**
       * END: FUNCTION MODIFIED
       */

      function clearForm() {
        document.getElementById("autoFillInput").value = "";
        document.getElementById("nameInput").value = "";
        document.getElementById("oldNumberInput").value = "";
        document.getElementById("nationalIdInput").value = "";
        document.getElementById("newNumberInput").value = "";
        document.getElementById("oldNumberMessage").innerText = "";
        document.getElementById("oldNumberMessage").className = "input-message";
        document.getElementById("nationalIdMessage").innerText = "";
        document.getElementById("nationalIdMessage").className =
          "input-message";
        document.getElementById("newNumberMessage").innerText = "";
        document.getElementById("newNumberMessage").className = "input-message";
        const provinceDiv = document.getElementById("provinceDisplay");
        provinceDiv.style.display = "none";
        provinceDiv.innerText = "";
        document.getElementById("copyResult").innerText = "";
        document.getElementById("copyResult").style.display = "none";

        // START: ÿÆÿ∑Ÿàÿ∑ ÿßÿ∂ÿßŸÅŸá ÿ¥ÿØŸá ÿ®ÿ±ÿß€å ÿ®ÿ≥ÿ™ŸÜ ⁄©ÿßÿØÿ± ŸÜŸÖÿß€åÿ¥ ŸÖÿ™ŸÜ
        document.getElementById("text-display-section").style.display = "none";
        document.getElementById("requestTextOutput").value = "";
        // END: ÿÆÿ∑Ÿàÿ∑ ÿßÿ∂ÿßŸÅŸá ÿ¥ÿØŸá

        document
          .getElementById("oldNumberInput")
          .classList.remove("input-error");
        document
          .getElementById("nationalIdInput")
          .classList.remove("input-error");
        document
          .getElementById("newNumberInput")
          .classList.remove("input-error");
        updateCopyButton();
      }

      updateCopyButton();

      // --- START: ÿ®ÿÆÿ¥ ÿ¨ÿØ€åÿØ ÿ®ÿ±ÿß€å ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ŸÑ€åÿ≥ÿ™ ÿßÿ≥ÿßŸÖ€å ---
      fetch("data/name.json")
        .then((res) => res.json())
        .then((data) => {
          nameList = data; // ŸÑ€åÿ≥ÿ™ ÿßÿ≥ÿßŸÖ€å ÿØÿ± ŸÖÿ™ÿ∫€åÿ± ÿ∞ÿÆ€åÿ±Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ
        })
        .catch((err) => {
          console.error("ÿÆÿ∑ÿß ÿØÿ± ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å name.json:", err);
        });

      function updateProvinceDisplay(pureValue) {
        const provinceDiv = document.getElementById("provinceDisplay");
        if (!pureValue || pureValue.length < 3) {
          provinceDiv.style.display = "none";
          provinceDiv.innerText = "";
          return;
        }
        const prefix = pureValue.slice(0, 3);

        // ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ÿ®Ÿá API ÿ¨ÿØ€åÿØ ÿ®ÿ±ÿß€å ⁄Øÿ±ŸÅÿ™ŸÜ ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿßÿ≥ÿ™ÿßŸÜ
        fetch(`/api/get_province_info.php?code=${prefix}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            // ŸÜŸÖÿß€åÿ¥ Ÿæ€åÿßŸÖ ÿØÿ± Ÿáÿ± ÿµŸàÿ±ÿ™
            provinceDiv.style.display = "block";

            if (data && data.province && data.city) {
              // ÿß⁄Øÿ± ÿØ€åÿ™ÿßÿ®€åÿ≥ ŸÜÿ™€åÿ¨Ÿá‚Äåÿß€å ÿ®ÿ±⁄Øÿ±ÿØÿßŸÜÿØ
              provinceDiv.innerText = `ÿßÿ≥ÿ™ÿßŸÜ ŸÖÿ≠ŸÑ ÿµÿØŸàÿ±: ${data.province} | ÿ¥Ÿáÿ± ŸÖÿ≠ŸÑ ÿµÿØŸàÿ±: ${data.city}`;
              provinceDiv.className = "input-message success"; // ÿßÿ≥ÿ™ÿß€åŸÑ ŸÖŸàŸÅŸÇ€åÿ™
            } else {
              // ÿß⁄Øÿ± ŸÜÿ™€åÿ¨Ÿá‚Äåÿß€å €åÿßŸÅÿ™ ŸÜÿ¥ÿØ
              provinceDiv.innerText =
                "‚ùå Ÿæ€åÿ¥‚Äåÿ¥ŸÖÿßÿ±Ÿá ⁄©ÿØŸÖŸÑ€å ÿØÿ± ÿ≥€åÿ≥ÿ™ŸÖ ÿ´ÿ®ÿ™ ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™.";
              provinceDiv.className = "input-message error"; // ÿßÿ≥ÿ™ÿß€åŸÑ ÿÆÿ∑ÿß
            }
          })
          .catch((error) => {
            console.error("ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿßÿ≥ÿ™ÿßŸÜ:", error);
            provinceDiv.style.display = "block";
            provinceDiv.innerText = "‚ö†Ô∏è ÿÆÿ∑ÿß€å€å ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ± ÿ±ÿÆ ÿØÿßÿØ.";
            provinceDiv.className = "input-message error";
          });
      }

      function autoFillForm() {
        const rawText = document.getElementById("autoFillInput").value.trim();
        if (!rawText) {
          alert("ŸÑÿ∑ŸÅÿßŸã ÿßÿ®ÿ™ÿØÿß ŸÖÿ™ŸÜ ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ.");
          return;
        }
        const text = normalizeDigits(rawText);
        const oldInput = document.getElementById("oldNumberInput");
        oldInput.value = "";
        oldInput.classList.remove("input-error");
        const oldMsg = document.getElementById("oldNumberMessage");
        oldMsg.innerText = "";
        oldMsg.className = "input-message";
        const newInput = document.getElementById("newNumberInput");
        newInput.value = "";
        newInput.classList.remove("input-error");
        const newMsg = document.getElementById("newNumberMessage");
        newMsg.innerText = "";
        newMsg.className = "input-message";
        const nationalInput = document.getElementById("nationalIdInput");
        nationalInput.value = "";
        nationalInput.classList.remove("input-error");
        const nationalMsg = document.getElementById("nationalIdMessage");
        nationalMsg.innerText = "";
        nationalMsg.className = "input-message";
        const provinceDiv = document.getElementById("provinceDisplay");
        provinceDiv.style.display = "none";
        provinceDiv.innerText = "";

        // ŸÖŸÜÿ∑ŸÇ ÿ¨ÿØ€åÿØ ÿ®ÿ±ÿß€å ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÜÿßŸÖ
        const nameInput = document.getElementById("nameInput");
        nameInput.value = ""; // ÿßÿ®ÿ™ÿØÿß ŸÅ€åŸÑÿØ ŸÜÿßŸÖ ÿ±ÿß Ÿæÿß⁄© ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ

        if (nameList.length > 0) {
          // ŸÅŸÇÿ∑ ÿØÿ± ÿµŸàÿ±ÿ™€å ⁄©Ÿá ŸÑ€åÿ≥ÿ™ ÿßÿ≥ÿßŸÖ€å ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá ÿ®ÿßÿ¥ÿØ
          const words = text.replace(/[.,!?]/g, "").split(/\s+/); // ŸÖÿ™ŸÜ ÿ±ÿß ÿ®Ÿá ⁄©ŸÑŸÖÿßÿ™ ÿ™ŸÇÿ≥€åŸÖ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ
          let foundName = "";

          for (let i = 0; i < words.length; i++) {
            // ⁄Ü⁄© ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ ⁄©Ÿá ÿ¢€åÿß ⁄©ŸÑŸÖŸá ŸÅÿπŸÑ€å ÿØÿ± ŸÑ€åÿ≥ÿ™ ÿßÿ≥ÿßŸÖ€å ŸÖÿß Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ
            if (nameList.includes(words[i])) {
              // ÿß⁄Øÿ± ÿßÿ≥ŸÖ Ÿæ€åÿØÿß ÿ¥ÿØÿå ÿ¢ŸÜ ÿ±ÿß ÿ®Ÿá ŸáŸÖÿ±ÿßŸá ⁄©ŸÑŸÖŸá ÿ®ÿπÿØ€å (ŸÅÿßŸÖ€åŸÑ€å) ÿ∞ÿÆ€åÿ±Ÿá ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ
              foundName = words[i];
              if (i + 1 < words.length) {
                // ŸÖÿ∑ŸÖÿ¶ŸÜ ŸÖ€å‚Äåÿ¥Ÿà€åŸÖ ⁄©ŸÑŸÖŸá ÿ®ÿπÿØ€å Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ
                foundName += " " + words[i + 1];
              }
              break; // ÿ®ÿπÿØ ÿßÿ≤ Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ÿßŸàŸÑ€åŸÜ ÿßÿ≥ŸÖÿå ÿßÿ≤ ÿ≠ŸÑŸÇŸá ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥Ÿà€åŸÖ
            }
          }

          if (foundName) {
            nameInput.value = foundName; // ŸÖŸÇÿØÿßÿ± ŸÅ€åŸÑÿØ ŸÜÿßŸÖ ÿ±ÿß ÿ™ŸÜÿ∏€åŸÖ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ
          }
        }

        const phoneMatches = text.match(/09\d{9}/g) || [];
        const nationalIdMatches = text.match(/\b\d{10}\b/g) || [];
        if (phoneMatches.length === 1) {
          newInput.value = phoneMatches[0];
          formatMobileNumber(newInput);
          validatePhone(newInput, "newNumberMessage", phoneMatches[0]);
        } else if (phoneMatches.length >= 2) {
          oldInput.value = phoneMatches[0];
          formatMobileNumber(oldInput);
          validatePhone(oldInput, "oldNumberMessage", phoneMatches[0]);
          newInput.value = phoneMatches[1];
          formatMobileNumber(newInput);
          validatePhone(newInput, "newNumberMessage", phoneMatches[1]);
        }
        if (nationalIdMatches.length >= 1) {
          nationalInput.value = nationalIdMatches[0];
          formatNationalId(nationalInput);
          validateNationalId(
            nationalInput,
            "nationalIdMessage",
            nationalIdMatches[0]
          );
          updateProvinceDisplay(nationalIdMatches[0]);
        }
        updateCopyButton();
      }
    </script>
  </body>
</html>
