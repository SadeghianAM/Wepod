<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ویکی ویپاد</title>
    <style>
      :root {
        --primary-color: #00ae70;
        --primary-dark: #089863;
        --bg-color: #f4fbf7;
        --text-color: #222;
        --text-secondary: #555;
        --card-bg: #ffffff;
        --header-text: #ffffff;
        --border-radius: 0.75rem;
        --border-radius-lg: 1.2rem;
        --shadow-color-light: rgba(0, 174, 112, 0.07);
        --shadow-color-medium: rgba(0, 174, 112, 0.12);
        --shadow-color-dark: rgba(0, 0, 0, 0.15);
      }
      @font-face {
        font-family: "Vazirmatn";
        src: url("/assets/fonts/Vazirmatn[wght].ttf") format("truetype");
        font-weight: 100 900;
        font-display: swap;
      }
      *,
      *::before,
      *::after {
        font-family: "Vazirmatn", sans-serif;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        direction: rtl;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      main {
        flex-grow: 1;
      }
      .search-container {
        text-align: center;
        max-width: 800px;
        width: 100%;
        padding: 2rem 1.5rem;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary-color);
        margin-bottom: 2rem;
      }
      .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        font-weight: 400;
        margin-top: -1.5rem;
        margin-bottom: 2.5rem;
      }
      .search-form {
        padding: 1rem;
        margin-bottom: 2rem;
      }
      .form-group {
        position: relative;
        margin-bottom: 1.5rem;
      }
      .form-group .icon {
        position: absolute;
        inset-inline-start: 1.2rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.2rem;
        color: #888;
        pointer-events: none;
      }
      input[type="text"],
      select {
        width: 100%;
        padding: 1rem;
        padding-inline-start: 3rem;
        font-size: 1.1rem;
        border: 1.5px solid #ddd;
        border-radius: var(--border-radius);
        outline: none;
        background-color: #f9f9f9;
        transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      select {
        cursor: pointer;
      }
      input[type="text"]:focus,
      select:focus {
        border-color: var(--primary-color);
        background-color: var(--card-bg);
        box-shadow: 0 0 0 3px rgba(0, 174, 112, 0.1);
      }
      .results {
        text-align: right;
      }
      .result-item {
        background: var(--card-bg);
        border-inline-start: 4px solid var(--primary-color);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 12px var(--shadow-color-light);
        transition: transform 0.3s, box-shadow 0.3s,
          border-inline-start-color 0.3s;
        cursor: pointer;
      }
      .result-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px var(--shadow-color-medium);
        border-inline-start-color: var(--primary-dark);
      }
      .result-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
      }
      .result-category,
      .result-id {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
        display: inline-block;
        background-color: var(--bg-color);
        padding: 0.2rem 0.6rem;
        border-radius: 0.5rem;
      }
      .result-id {
        margin-right: 0.5rem;
      }
      .result-desc {
        font-size: 1.05rem;
        line-height: 1.7;
      }
      .no-result {
        color: #999;
        margin-top: 2rem;
        font-size: 1.1rem;
        text-align: center;
      }
      #toast {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--primary-dark);
        color: var(--header-text);
        padding: 0.8rem 1.5rem;
        border-radius: var(--border-radius);
        font-size: 1rem;
        box-shadow: 0 4px 16px var(--shadow-color-dark);
        z-index: 9999;
        transition: opacity 0.4s ease, transform 0.4s ease;
        opacity: 0;
        pointer-events: none;
      }
      #toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-10px);
      }
      @media (max-width: 600px) {
        .search-container {
          padding: 1.5rem 1rem;
        }
        h1 {
          font-size: 2rem;
        }
        .search-form {
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="header-placeholder"></div>
    <main class="search-container">
      <h1>ویکی ویپاد</h1>
      <p class="subtitle">دسترسی مستقیم به تمامی مطالب موجود در درخت دانش</p>
      <div class="search-form">
        <div class="form-group">
          <span class="icon">🔍</span>
          <input
            type="text"
            id="search-input"
            placeholder="جستجو در ویکی..."
            aria-label="جستجو در ویکی"
          />
        </div>
        <div class="form-group">
          <span class="icon">🗂️</span>
          <select id="category-filter" aria-label="فیلتر بر اساس دسته بندی">
            <option value="">همه دسته‌ها</option>
          </select>
        </div>
      </div>
      <div class="results" id="results-container"></div>
    </main>
    <div id="toast">کپی شد!</div>
    <div id="footer-placeholder"></div>
    <script src="/js/app.js"></script>
    <script>
      function toPersianDigits(num) {
        return num.toString().replace(/\d/g, (d) => "۰۱۲۳۴۵۶۷۸۹"[d]);
      }
      let data = [];
      const searchInput = document.getElementById("search-input");
      const categoryFilter = document.getElementById("category-filter");
      const resultsContainer = document.getElementById("results-container");
      fetch("/data/wiki.json")
        .then((res) => res.json())
        .then((json) => {
          data = json;
          populateCategories(json);
          searchInput.placeholder = `جستجو از میان ${toPersianDigits(
            data.length
          )} متن آماده`;
        });
      searchInput.addEventListener("input", filterResults);
      categoryFilter.addEventListener("change", filterResults);
      function populateCategories(data) {
        const categoriesSet = new Set();
        data.forEach((item) => {
          (item.categories || []).forEach((cat) => categoriesSet.add(cat));
        });
        const categories = Array.from(categoriesSet);
        categories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat;
          option.textContent = cat;
          categoryFilter.appendChild(option);
        });
      }
      function filterResults() {
        const term = searchInput.value.trim().toLowerCase();
        if (term === "") {
          resultsContainer.innerHTML = "";
          return;
        }
        const selectedCategories = Array.from(categoryFilter.selectedOptions)
          .map((opt) => opt.value)
          .filter((v) => v);
        const filtered = data.filter((item) => {
          const matchesTerm =
            item.title.toLowerCase().includes(term) ||
            item.description.toLowerCase().includes(term) ||
            (item.id && item.id.toString().includes(term));
          const matchesCategory =
            !selectedCategories.length ||
            (item.categories &&
              item.categories.some((cat) => selectedCategories.includes(cat)));
          return matchesTerm && matchesCategory;
        });
        resultsContainer.innerHTML = "";
        if (filtered.length === 0) {
          resultsContainer.innerHTML =
            '<div class="no-result">نتیجه‌ای یافت نشد.</div>';
          return;
        }
        filtered.forEach((item) => {
          const box = document.createElement("div");
          box.className = "result-item";
          box.innerHTML = `
            <div class="result-title">${item.title}</div>
            <div class="result-category">دسته‌ها: ${(
              item.categories || []
            ).join("، ")}</div>
            <div class="result-id">آیدی: ${toPersianDigits(item.id)}</div>
            <div class="result-desc">${item.description.replace(
              /\n/g,
              "<br>"
            )}</div>
          `;
          box.addEventListener("click", () => {
            navigator.clipboard
              .writeText(item.description)
              .then(() => {
                showToast("محتوا کپی شد!");
                box.style.backgroundColor = "#e6fff4";
                setTimeout(() => {
                  box.style.backgroundColor = "#ffffff";
                }, 800);
              })
              .catch((err) => {
                console.error("خطا در کپی:", err);
                showToast("کپی نشد!");
              });
          });
          resultsContainer.appendChild(box);
        });
      }
      function showToast(message = "کپی شد!") {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.add("show");
        toast.style.display = "block";
        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => {
            toast.style.display = "none";
          }, 400);
        }, 2000);
      }
    </script>
  </body>
</html>
